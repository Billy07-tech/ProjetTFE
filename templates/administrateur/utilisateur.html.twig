{% extends 'base.html.twig' %}

{% block title %}Utilisateurs
{% endblock %}

{% block body %}
	<div class="admin-users">
		<h1>Utilisateurs</h1>

		<form method="get" action="{{ path('admin_users') }}" class="admin-search">
			<input type="text" name="q" value="{{ q|default('') }}" placeholder="Rechercher un pseudo ou un email">
			<button type="submit">Rechercher</button>
		</form>

		{% set utilisateurs = utilisateurs|default([]) %}

		{% if utilisateurs is empty %}
			<p>Aucun utilisateur trouvé.</p>
		{% else %}
			<table class="admin-table">
				<thead>
					<tr>
						<th>Pseudo</th>
						<th>Email</th>
						<th>Rôles</th>
						<th style="width:260px">Actions</th>
					</tr>
				</thead>
				<tbody>
					{% for u in utilisateurs %}
						<tr>
							<td>{{ u.pseudo }}</td>
							<td>{{ u.email }}</td>
							<td>
								{% set roles = u.roles is iterable ? u.roles : (u.roles ? [u.roles] : []) %}
								<span class="badge {{ 'ROLE_ADMIN' in roles ? 'badge-admin' : 'badge-user' }}">
									{{ 'ROLE_ADMIN' in roles ? 'Admin' : 'Utilisateur' }}
								</span>
							</td>
							<td class="admin-actions">
								<form method="post" action="{{ path('admin_user_delete', {id: u.id}) }}" onsubmit="return confirm('Supprimer cet utilisateur ?');" style="display:inline">
									<input type="hidden" name="_token" value="{{ csrf_token('delete' ~ u.id) }}">
									<button type="submit" class="btn btn-danger">Supprimer</button>
								</form>
							</td>
						</tr>
					{% endfor %}
				</tbody>
			</table>
		{% endif %}
	</div>
{% endblock %}
