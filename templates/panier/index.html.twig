{# templates/panier/index.html.twig #}
{% extends 'base.html.twig' %}

{% block title %}Mon Panier
{% endblock %}

{% block body %}
	<div class="page--panier">
		<div class="cart-wrap">
			<h1>Mon Panier</h1>

			{% if panier and panier.items|length > 0 %}
				{% set total = 0 %}
				<table class="cart-table">
					<thead>
						<tr>
							<th>Produit</th>
							<th>Quantité</th>
							<th>Prix</th>
							<th>Total</th>
							<th>Actions</th>
						</tr>
					</thead>
					<tbody>
						{% for item in panier.items %}
							{% set ligne = item.produit.prix * item.quantite %}
							{% set total = total + ligne %}
							<tr>
								<td>
									<span
										class="prod-name">
										{# URL d’image via Vich (champ 'imageFile') #}
										{% set img = vich_uploader_asset(item.produit, 'imageFile') %}
										{% if img %}
											<img src="{{ img }}" alt="{{ item.produit.nom }}" class="prod-img">
										{% endif %}
										{{ item.produit.nom }}
									</span>
								</td>

								<td>
									<div class="qty">
										<a href="{{ path('panier_decrease', {id: item.produit.id}) }}" class="btn-qty">−</a>
										<span class="value">{{ item.quantite }}</span>
										<a href="{{ path('panier_increase', {id: item.produit.id}) }}" class="btn-qty">+</a>
									</div>
								</td>

								<td class="price">
									{{ item.produit.prix|number_format(2, '.', ',') }}
									€
								</td>

								<td class="row-total">
									{{ ligne|number_format(2, '.', ',') }}
									€
								</td>

								<td>
									<a href="{{ path('panier_remove', {id: item.produit.id}) }}" class="btn btn-danger">Supprimer</a>
								</td>
							</tr>
						{% endfor %}
					</tbody>
				</table>

				<div class="cart-footer">
					<div class="actions">
						<a href="{{ path('panier_clear') }}" class="btn btn-warning">Vider le panier</a>
						<a href="{{ path('panier_checkout') }}" class="btn btn-success">Payer</a>
					</div>
					<div class="total-box">
						Total :
						{{ total|number_format(2, '.', ',') }}
						€
					</div>
				</div>

			{% else %}
				<div class="empty">
					Votre panier est vide.
				</div>
			{% endif %}
		</div>
	</div>
{% endblock %}
